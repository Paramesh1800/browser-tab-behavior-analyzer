<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Warning — Suspicious Site</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; max-width: 600px; }
    h1 { color: #c0392b; }
    .meta { margin-top: 8px; color: #555; word-break: break-all; }
    .buttons { margin-top: 18px; }
    button { padding: 8px 12px; margin-right: 10px; font-size: 14px; }
    .proceed { background: #27ae60; color: white; border: none; border-radius: 6px; }
    .back { background: #e74c3c; color: white; border: none; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>⚠ Suspicious website blocked</h1>
  <p>This page blocked a high-risk website based on multiple heuristics (punycode/homograph, suspicious TLD, keywords, subdomain patterns).</p>

  <div class="meta">
    <div><strong>Original URL:</strong> <span id="orig"></span></div>
    <div><strong>Risk Score:</strong> <span id="risk"></span></div>
    <div><strong>Triggered:</strong> <span id="kw"></span></div>
  </div>

  <div class="buttons">
    <button class="proceed" id="proceedBtn">Proceed anyway (allow once)</button>
    <button class="back" id="backBtn">Go back</button>
  </div>

  <script>
    // Parse query params for orig and r
    function params() {
      const s = location.search.substring(1);
      const out = {};
      s.split("&").forEach(p => {
        if (!p) return;
        const [k,v] = p.split("=");
        out[decodeURIComponent(k)] = decodeURIComponent(v || "");
      });
      return out;
    }

    const p = params();
    const orig = p.orig || "";
    const risk = p.r || "";
    document.getElementById("orig").textContent = orig;
    document.getElementById("risk").textContent = risk;

    // Try to read lastTriggered from storage to show keywords
    chrome.storage.local.get(["lastTriggered","lastUrl"], data => {
      let kws = data.lastTriggered || [];
      // Sometimes storage may have different url; show available keywords
      document.getElementById("kw").textContent = kws.length ? kws.join(", ") : "None";
    });

    document.getElementById("backBtn").addEventListener("click", () => {
      // go back to previous page or open about:blank
      window.history.back();
      // also attempt to close tab (not always permitted)
      try { window.close(); } catch(e) {}
    });

    document.getElementById("proceedBtn").addEventListener("click", () => {
      // Send message to background to allow once and navigate
      chrome.runtime.sendMessage({ type: "ALLOW_ONCE", origUrl: orig }, (resp) => {
        // close warning page (background will navigate)
        window.close();
      });
    });
  </script>
</body>
</html>
